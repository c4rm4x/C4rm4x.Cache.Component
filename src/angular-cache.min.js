"use strict";var cacheMain=angular.module("angular-cache-main",["angular-cache-services"]),cacheServices=angular.module("angular-cache-services",["ngStorage"]);cacheServices.service("cacheConfig",[function(){this.configuration={baseApiUrls:[],console:!1,param:"rev"},this.setConfiguration=function(a){this.configuration.baseApiUrls=a.baseApiUrls||[],this.configuration.console=a.console||!1,this.configuration.param=a.param||"rev"},this.getConfiguration=function(){return this.configuration}}]),cacheServices.service("cacheStorage",["$sessionStorage",function(a){this.getCache=function(){return a.cache||{}},this.setCache=function(b){a.cache=b}}]),cacheServices.service("cacheManager",["cacheConfig","cacheStorage",function(a,b){function c(b,c){var d=a.getConfiguration().baseApiUrls.filter(function(a){return c&&a.strict?b===a.url:b.indexOf(a.url)>=0});if(d&&d.length>0)return d[0].url}function d(a,c){var d=1;return a[c]=d,b.setCache(a),d}function e(b,c){var d=b[c];d&&(b[c]=Number(d)+1,a.getConfiguration().console&&console.log("Invalidating cache for "+c))}function f(a,b){Object.keys(a).forEach(function(c){c!==b&&c.indexOf(b)>=0&&e(a,c)})}this.getActualUrl=function(e){var f,g;return c(e,!0)?(g=b.getCache(),f=g[e],f||(f=d(g,e)),e+"?"+a.getConfiguration().param+"="+f):e},this.invalidateCache=function(a,d){var g,h;"GET"!==a&&"HEAD"!==a&&"JSONP"!==a&&"OPTIONS"!==a&&(h=c(d))&&(g=b.getCache(),e(g,h),"PUT"!==a&&"DELETE"!==a||(e(g,d),f(g,d+"/")),b.setCache(g))},this.invalidateDescendants=function(a){var c=b.getCache();f(c,a),b.setCache(c)}}]),cacheServices.service("cacheRequestInterceptor",["$cacheFactory","cacheManager",function(a,b){function c(a){return a.indexOf(".html")>=0}var d=a("customCache");this.request=function(a){return"GET"!==a.method||c(a.url)||(a.cache=d,a.url=b.getActualUrl(a.url)),a},this.response=function(a){return"POST"===a.config.method||"PUT"===a.config.method||"DELETE"===a.config.method?b.invalidateCache(a.config.method,a.config.url):"GET"!==a.config.method||c(a.config.url)||d.remove(a.config.url),a}}]);